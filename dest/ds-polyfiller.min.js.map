{"version":3,"sources":["ds-polyfiller.min.js"],"names":["Polyfiller","count","listener","ready","error","parentNode","document","getElementsByTagName","mapping","map","this","test","calling","promise","type","load","then","response","bind","onLoaded","onError","console","warn","callback","push","catch","forEach","event","url","hasOwnProperty","Promise","resolve","reject","script","createElement","src","rel","href","onload","onreadystatechange","readyState","onerror","appendChild"],"mappings":"AAOA,GAAIA,aACFC,MAAO,EACPC,UACEC,SACAC,UAEFC,WAAYC,SAASC,qBAAqB,QAAQ,IAAMD,SAASC,qBAAqB,QAAQ,GAC9FC,WAEAC,IAAK,SAASD,GAEZ,MADAE,MAAKF,QAAUA,EACRE,MAQTC,KAAM,SAAUA,EAAMC,GAKpB,GAJoB,kBAATD,KACTA,EAAOA,KAGLA,KAAS,EACX,MAAOD,KAGT,IACIG,GADAC,QAAcF,EA2BlB,OAtBEC,GADU,YAARC,EACQF,IAIAF,KAAKK,KAAKH,GAIlBC,GAAmC,kBAAjBA,GAAQG,MAC5BN,KAAKT,QACLY,EACGG,KAAK,SAASC,GAEb,MADAP,MAAKT,QACEgB,GACPC,KAAKR,OACNM,KAAKN,KAAKS,SAASD,KAAKR,OAL3BG,SAMSH,KAAKU,QAAQF,KAAKR,SAE3BW,QAAQC,KAAK,4BACbZ,KAAKS,YAGAT,MAOTP,MAAO,SAASoB,GAGd,MAFAb,MAAKR,SAASC,MAAMqB,KAAKD,GACzBb,KAAKS,WACET,MAQTe,QAAO,SAASF,GAEd,MADAb,MAAKR,SAASE,MAAMoB,KAAKD,GAClBb,MAMTS,SAAU,WACDT,KAAKT,OACVS,KAAKR,SAASC,MAAMuB,QAAQ,SAASxB,GACnCA,OAKNkB,QAAS,SAASO,GAChBjB,KAAKR,SAASE,MAAMsB,QAAQ,SAASxB,GACnCA,EAASyB,MAYbZ,KAAM,SAAUa,EAAKd,GACnB,GAAIT,GAAaK,KAAKL,UAOtB,OAJIK,MAAKF,QAAQqB,eAAeD,KAC9BA,EAAMlB,KAAKF,QAAQoB,IAGd,GAAIE,SAAQ,SAASC,EAASC,GACnC,GAAIC,GAAS3B,SAAS4B,cAAcpB,EAAOA,EAAO,SAErC,YAATA,EACFmB,EAAOE,IAAMP,GAEbK,EAAOG,IAAM,aACbH,EAAOnB,KAAO,WACdmB,EAAOI,KAAOT,GAGhBK,EAAOK,OAASL,EAAOM,mBAAqB,SAAUZ,GAC9CjB,KAAK8B,YAAkC,WAApB9B,KAAK8B,YAA+C,aAApB9B,KAAK8B,YAC5DT,EAAQJ,IAGZM,EAAOQ,QAAUT,EACjB3B,EAAWqC,YAAYT","file":"ds-polyfiller.min.js","sourcesContent":["/**\r\n * Polyfiller\r\n *\r\n * @ecmascript 5\r\n * @require promise\r\n */\r\n\r\nvar Polyfiller = {\r\n  count: 0,\r\n  listener: {\r\n    ready: [],\r\n    error: []\r\n  },\r\n  parentNode: document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0],\r\n  mapping: {},\r\n  \r\n  map: function(mapping) {\r\n    this.mapping = mapping;\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * @param test\r\n   * @param calling\r\n   * @returns {Polyfiller}\r\n   */\r\n  test: function (test, calling) {\r\n    if (typeof test === 'function') {\r\n      test = test();\r\n    }\r\n\r\n    if (test === true) {\r\n      return this;\r\n    }\r\n\r\n    var type = typeof calling;\r\n    var promise;\r\n\r\n    // load by function\r\n    if (type == 'function') {\r\n      promise = calling();\r\n    }\r\n    // load by url\r\n    else {\r\n      promise = this.load(calling);\r\n    }\r\n\r\n    // regist promise\r\n    if (promise && typeof promise.then === 'function') {\r\n      this.count++;\r\n      promise\r\n        .then(function(response) {\r\n          this.count--;\r\n          return response;\r\n        }.bind(this))\r\n        .then(this.onLoaded.bind(this))\r\n        .catch(this.onError.bind(this));\r\n    } else {\r\n      console.warn('calling not promise like');\r\n      this.onLoaded();\r\n    }\r\n\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * @param callback\r\n   * @returns {Polyfiller}\r\n   */\r\n  ready: function(callback) {\r\n    this.listener.ready.push(callback);\r\n    this.onLoaded();\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   *\r\n   * @param callback\r\n   * @returns {Polyfiller}\r\n   */\r\n  catch: function(callback) {\r\n    this.listener.error.push(callback);\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * interal event called after loaded\r\n   */\r\n  onLoaded: function() {\r\n    if ( ! this.count) {\r\n      this.listener.ready.forEach(function(listener) {\r\n        listener();\r\n      })\r\n    }\r\n  },\r\n\r\n  onError: function(event) {\r\n    this.listener.error.forEach(function(listener) {\r\n      listener(event);\r\n    })\r\n  },\r\n\r\n  /**\r\n   * internal loader\r\n   * support script and link tags\r\n   *\r\n   * @param url\r\n   * @param type\r\n   * @returns {Promise}\r\n   */\r\n  load: function (url, type) {\r\n    var parentNode = this.parentNode;\r\n\r\n    // overwrite url by mapping\r\n    if (this.mapping.hasOwnProperty(url)) {\r\n      url = this.mapping[url];\r\n    }\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      var script = document.createElement(type ? type : 'script');\r\n\r\n      if (type === 'script') {\r\n        script.src = url;\r\n      } else {\r\n        script.rel = 'stylesheet';\r\n        script.type = 'text/css';\r\n        script.href = url;\r\n      }\r\n\r\n      script.onload = script.onreadystatechange = function (event) {\r\n        if ((!this.readyState || this.readyState === \"loaded\" || this.readyState === \"complete\")) {\r\n          resolve(event);\r\n        }\r\n      };\r\n      script.onerror = reject;\r\n      parentNode.appendChild(script);\r\n    });\r\n  }\r\n};"],"sourceRoot":"/source/"}